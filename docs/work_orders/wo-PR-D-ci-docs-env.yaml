id: wo-PR-D-ci-docs-env
title: "CI/문서/환경키 통합 (pre→gate→post + DR 리허설 자동화)"
scope:
  - CI 파이프라인에 pre/gate/post 세 단계 배선
  - Evidence index/GC dry-run → ObjectLock 업로드(stub/aws) → DR 복구(stub/aws)
  - 환경키 일괄 정의(.env.example) 및 문서/런북 반영
deliverables:
  - .github/workflows/ci.yml
  - .env.example
  - docs/ops/EVIDENCE-GC.md
  - docs/ops/RUNBOOK-DR.md
  - docs/CHANGELOG.md
  - scripts/ci/summary_postgate.py
env:
  required:
    - DECISIONOS_S3_MODE
    - DECISIONOS_S3_BUCKET
    - DECISIONOS_S3_PREFIX
    - DECISIONOS_S3_STUB_ROOT
    - DECISIONOS_S3_DRY_RUN
    - DECISIONOS_DR_POLICY_PATH
    - DECISIONOS_DR_DEST
    - DECISIONOS_DR_DRY_RUN
    - DECISIONOS_EVIDENCE_DIR
    - DECISIONOS_EVIDENCE_INDEX
    - DECISIONOS_ALLOW_SCOPES
    - DECISIONOS_SECURITY_HEADERS_ENABLE
    - DECISIONOS_PII_ENABLE
  optional_aws:
    - AWS_REGION
    - AWS_DEFAULT_REGION
    - AWS_ACCESS_KEY_ID
    - AWS_SECRET_ACCESS_KEY
    - AWS_SESSION_TOKEN
ci_pipeline:
  pre_gate:
    - python -m apps.obs.evidence.indexer
    - python -m jobs.evidence_gc --dry-run 1
  gate:
    - python -m jobs.evidence_objectlock
    - python -m apps.cli.dosctl.judge_quorum (option)
  post_gate:
    - python -m jobs.dr_restore
    - python scripts/ci/summary_postgate.py
acceptance:
  - pre_gate/gate/post_gate 전부 Green
  - evidence index/gc/objectlock/dr 아티팩트 업로드
  - stub→aws 모드 전환 시 동일 워크플로 사용 가능
rollback:
  - CI 워크플로에서 해당 job 제거
  - .env.example 원복
security_notes:
  - stub 모드 기본값으로 외부 유출 없음
  - aws 시크릿은 GitHub Actions Secrets 로 관리
