<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DecisionOS Offline Evaluation Report</title>
    <style>
      :root {
        --color-bg: #f8f9fa;
        --color-card: #ffffff;
        --color-border: #dee2e6;
        --color-primary: #0d6efd;
        --color-success: #198754;
        --color-warning: #ffc107;
        --color-danger: #dc3545;
        --color-text: #212529;
        --color-text-muted: #6c757d;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: var(--color-bg);
        color: var(--color-text);
      }

      .header {
        margin-bottom: 2rem;
      }

      h1 {
        font-size: 2rem;
        font-weight: 600;
        margin: 0 0 0.5rem 0;
      }

      .meta {
        color: var(--color-text-muted);
        font-size: 0.9rem;
      }

      .contract-badge {
        display: inline-block;
        background: var(--color-primary);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 4px;
        font-size: 0.875rem;
        font-weight: 500;
        margin-left: 0.5rem;
      }

      .kpi-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .card {
        background: var(--color-card);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      }

      .value {
        font-size: 2.5rem;
        font-weight: 700;
        line-height: 1;
        margin-bottom: 0.5rem;
      }

      .value.good { color: var(--color-success); }
      .value.warning { color: var(--color-warning); }
      .value.danger { color: var(--color-danger); }

      .label {
        color: var(--color-text-muted);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
      }

      .bar-container {
        margin-top: 0.75rem;
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
      }

      .bar {
        height: 100%;
        transition: width 0.5s ease;
      }

      .bar.good { background: var(--color-success); }
      .bar.warning { background: var(--color-warning); }
      .bar.danger { background: var(--color-danger); }

      .metadata-section {
        background: var(--color-card);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 2rem;
      }

      .metadata-section h2 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0 0 1rem 0;
      }

      .metadata-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .metadata-item {
        display: flex;
        flex-direction: column;
      }

      .metadata-label {
        color: var(--color-text-muted);
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
      }

      .metadata-value {
        font-weight: 500;
      }

      .footer {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid var(--color-border);
        text-align: center;
        color: var(--color-text-muted);
        font-size: 0.875rem;
      }

      @media (max-width: 768px) {
        body { padding: 1rem; }
        .kpi-grid { grid-template-columns: 1fr; }
        .value { font-size: 2rem; }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>
        Offline Evaluation Report
        {% if contract %}
        <span class="contract-badge">{{ contract }}</span>
        {% endif %}
      </h1>
      <div class="meta">Generated: {{ now }}</div>
    </div>

    <div class="kpi-grid">
      {% set reject_precision = (metrics.reject_precision or 0) %}
      {% set reject_recall = (metrics.reject_recall or 0) %}
      {% set review_rate = (metrics.review_rate or 0) %}

      <div class="card">
        <div class="value {% if reject_precision >= 0.9 %}good{% elif reject_precision >= 0.7 %}warning{% else %}danger{% endif %}">
          {{ (reject_precision * 100) | round(2) }}%
        </div>
        <div class="label">Reject Precision</div>
        <div class="bar-container">
          <div class="bar {% if reject_precision >= 0.9 %}good{% elif reject_precision >= 0.7 %}warning{% else %}danger{% endif %}"
               style="width: {{ (reject_precision * 100) | round(1) }}%"></div>
        </div>
      </div>

      <div class="card">
        <div class="value {% if reject_recall >= 0.9 %}good{% elif reject_recall >= 0.7 %}warning{% else %}danger{% endif %}">
          {{ (reject_recall * 100) | round(2) }}%
        </div>
        <div class="label">Reject Recall</div>
        <div class="bar-container">
          <div class="bar {% if reject_recall >= 0.9 %}good{% elif reject_recall >= 0.7 %}warning{% else %}danger{% endif %}"
               style="width: {{ (reject_recall * 100) | round(1) }}%"></div>
        </div>
      </div>

      <div class="card">
        <div class="value {% if review_rate <= 0.2 %}good{% elif review_rate <= 0.4 %}warning{% else %}danger{% endif %}">
          {{ (review_rate * 100) | round(2) }}%
        </div>
        <div class="label">Review Rate</div>
        <div class="bar-container">
          <div class="bar {% if review_rate <= 0.2 %}good{% elif review_rate <= 0.4 %}warning{% else %}danger{% endif %}"
               style="width: {{ (review_rate * 100) | round(1) }}%"></div>
        </div>
      </div>

      {% if metrics.approve_precision is defined %}
      <div class="card">
        <div class="value">{{ ((metrics.approve_precision or 0) * 100) | round(2) }}%</div>
        <div class="label">Approve Precision</div>
      </div>
      {% endif %}

      {% if metrics.approve_recall is defined %}
      <div class="card">
        <div class="value">{{ ((metrics.approve_recall or 0) * 100) | round(2) }}%</div>
        <div class="label">Approve Recall</div>
      </div>
      {% endif %}

      {% if metrics.f1_score is defined %}
      <div class="card">
        <div class="value">{{ ((metrics.f1_score or 0) * 100) | round(2) }}%</div>
        <div class="label">F1 Score</div>
      </div>
      {% endif %}
    </div>

    {% if metadata %}
    <div class="metadata-section">
      <h2>Evaluation Metadata</h2>
      <div class="metadata-grid">
        {% if metadata.total_rows %}
        <div class="metadata-item">
          <div class="metadata-label">Total Rows</div>
          <div class="metadata-value">{{ metadata.total_rows }}</div>
        </div>
        {% endif %}

        {% if metadata.label_key %}
        <div class="metadata-item">
          <div class="metadata-label">Label Key</div>
          <div class="metadata-value">{{ metadata.label_key }}</div>
        </div>
        {% endif %}

        {% if metadata.csv_path %}
        <div class="metadata-item">
          <div class="metadata-label">Source CSV</div>
          <div class="metadata-value">{{ metadata.csv_path }}</div>
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <div class="footer">
      Generated by DecisionOS-Lite Rule Engine
    </div>
  </body>
</html>

