# ===== Core / Ops =====
# Environment: dev, staging, prod
DECISIONOS_ENV=dev
DECISIONOS_SLACK_WEBHOOK=
DECISIONOS_SLACK_CHANNEL_OVERRIDE=
DECISIONOS_REDIS_URL=
DECISIONOS_SSM_PARAM_JUDGE_KEYS=/decisionos/judge/keys

# ===== Evidence & S3 (default: stub) =====
DECISIONOS_S3_MODE=stub
DECISIONOS_S3_BUCKET=decisionos-evidence
DECISIONOS_S3_PREFIX=evidence/
DECISIONOS_S3_STUB_ROOT=var/s3_stub
DECISIONOS_S3_DRY_RUN=0
DECISIONOS_S3_OBJECTLOCK_MODE=GOVERNANCE
DECISIONOS_S3_OBJECTLOCK_RETENTION_DAYS=30
DECISIONOS_S3_UPLOAD_ONLY_LOCKED=1

# ===== Evidence Index/GC/DR =====
DECISIONOS_EVIDENCE_DIR=var/evidence
DECISIONOS_EVIDENCE_INDEX=var/evidence/index.json
DECISIONOS_DR_POLICY_PATH=configs/dr/sample_policy.json
DECISIONOS_DR_DEST=var/evidence/restore
DECISIONOS_DR_DRY_RUN=0
DECISIONOS_OBJECTLOCK_REPORT=var/evidence/objectlock-report.json
DECISIONOS_DR_REPORT_PATH=var/dr/restore-report.json

# ===== Cards API / Dashboard =====
DECISIONOS_CARDS_TTL=60

# ===== Service Toggles =====
DECISIONOS_ALLOW_SCOPES=ops:read judge:run deploy:promote deploy:abort
DECISIONOS_SECURITY_HEADERS_ENABLE=0
DECISIONOS_PII_ENABLE=0
DECISIONOS_PII_MODE=soft   # soft|hard (partial vs full redaction)
DECISIONOS_TRUSTED_PROXY_CIDRS=
DECISIONOS_ALLOWED_HOSTS=
DECISIONOS_JUDGE_ALLOWED_HOSTS=
DECISIONOS_RL_ENABLE=0
DECISIONOS_RL_BACKEND=memory
DECISIONOS_REDIS_DSN=
DECISIONOS_READY_FAIL_CLOSED=1
DECISIONOS_RBAC_MAP=apps/policy/rbac_map.yaml
DECISIONOS_RBAC_DEFAULT_DENY=0
DECISIONOS_RBAC_RELOAD_SEC=2
# Security (v0.5.11u-5): Test mode OFF by default, MUST be 0 in production
DECISIONOS_RBAC_TEST_MODE=0
DECISIONOS_RBAC_MODE=OR   # OR|AND
DECISIONOS_RBAC_BYPASS_PREFIXES=/healthz,/readyz,/metrics

# ===== CORS (v0.5.11u-5) =====
# Production MUST have explicit allowlist (no wildcard)
# Dev default: http://localhost:3000,http://127.0.0.1:3000
# Example: https://app.example.com,https://console.example.com
DECISIONOS_CORS_ALLOWLIST=

# ===== Compression (v0.5.11u-7) =====
# Response and storage compression (gzip)
DECISIONOS_COMPRESS_ENABLE=1
DECISIONOS_COMPRESS_MIN_BYTES=4096
DECISIONOS_GZIP_LEVEL=6
DECISIONOS_SNAPSHOT_COMPRESS=1
DECISIONOS_S3_COMPRESS=1
DECISIONOS_S3_STUB_BASE=var/s3

DECISIONOS_ETAG_BACKEND=memory   # memory|redis
DECISIONOS_SNAPSHOT_BACKEND=memory   # memory|redis (for delta ETags)
DECISIONOS_RBAC_MAP_PATH=configs/policy/rbac_map.yaml
DECISIONOS_RBAC_MAP_CHECK_SEC=15
DECISIONOS_RBAC_MAP=
DECISIONOS_CARDS_TTL=60
DECISIONOS_TOP_IMPACT_N=5
DECISIONOS_LABEL_CATALOG_SHA=
DECISIONOS_EVIDENCE_INDEX=var/evidence/index.json
DECISIONOS_LABEL_CATALOG=configs/labels/label_catalog_v2.json
DECISIONOS_REDIS_URL=
DECISIONOS_SNAPSHOT_TTL=600
DECISIONOS_DELTA_FORCE_FULL_PROBE_PCT=1
DECISIONOS_ALERT_P95_MS=250
DECISIONOS_ALERT_RETRY_RATE=0.05
DECISIONOS_ALERT_ETAG_HIT_MIN=0.60
DECISIONOS_CONSENT_BACKEND=memory
DECISIONOS_CONSENT_SQLITE_PATH=var/consent.db
DECISIONOS_CONSENT_REDIS_DSN=

# --- v0.5.11t Cards/RBAC/ETag/readyz ---
# Evidence index & label catalog
DECISIONOS_EVIDENCE_INDEX=var/evidence/index.json
DECISIONOS_LABEL_CATALOG=configs/labels/label_catalog_v2.json

# Cards API cache/ETag options
DECISIONOS_CARDS_TTL=60
DECISIONOS_TOP_IMPACT_N=5

# RBAC map unification
# Option A: inline YAML (take precedence when non-empty)
# DECISIONOS_RBAC_MAP=routes:\n  - path: /ops/cards/*\n    scopes_any: [ops:read]
# Option B: file path (used when DECISIONOS_RBAC_MAP empty)
DECISIONOS_RBAC_MAP_PATH=configs/policy/rbac_map.yaml

# RBAC test mode (allow X-Scopes header in tests). Keep 0 in prod.
DECISIONOS_RBAC_TEST_MODE=0

# Optional Redis backend (ETag/Cache). If empty, in-memory is used.
# Example: redis://localhost:6379/0
DECISIONOS_REDIS_URL=
DECISIONOS_RBAC_MAP_PATH=configs/policy/rbac_map.yaml
DECISIONOS_RBAC_MAP_CHECK_SEC=15
DECISIONOS_CARDS_TTL=60
DECISIONOS_TOP_IMPACT_N=5

# ===== Executor / Storage / Delta (v0.5.11t) =====
# Executor backend (default: memory, optional: redis)
DECISIONOS_EXECUTOR_BACKEND=memory

# ETag Store backend (memory | redis)
DECISIONOS_ETAG_BACKEND=memory
# REDIS_DSN=redis://localhost:6379/0  # Uncomment to use Redis

# Snapshot Store backend for Delta ETag (memory | redis)
DECISIONOS_SNAPSHOT_BACKEND=memory

# TTL for ETag store (seconds)
DECISIONOS_ETAG_TTL_SEC=86400

# Executor HTTP plugin timeout (seconds)
DECISIONOS_EXEC_HTTP_TIMEOUT=5
DECISIONOS_EXEC_HTTP_RETRIES=1
DECISIONOS_EXEC_HTTP_BACKOFF_BASE=0.1
# (optional) HMAC signing
DECISIONOS_EXEC_HTTP_HMAC_KEY=
DECISIONOS_EXEC_HTTP_KEY_ID=decisionos
DECISIONOS_EXEC_HTTP_RETRY_NON_IDEMPOTENT=0
DECISIONOS_EXEC_HTTP_MASK_FIELDS=password,secret,token

# Ops Cards tenant prefix (optional)
DECISIONOS_TENANT=

# Label catalog SHA for strong ETag (set by CI or computed)
DECISIONOS_LABEL_CATALOG_SHA=

# ===== Optional AWS (set via CI secrets) =====
# AWS_REGION=
# AWS_DEFAULT_REGION=
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_SESSION_TOKEN=

# ===== Secrets Manager (u-10) =====
DECISIONOS_SECRETS_TTL=300
DECISIONOS_SECRET_PREFIX=APP_
DECISIONOS_AWS_SM_ENABLE=0
DECISIONOS_AWS_SM_PREFIX=/decisionos/prod/
AWS_REGION=ap-northeast-2

# ===== HTTP Pool + Circuit Breaker (u-11) =====
DECISIONOS_HTTP_TIMEOUT=5
DECISIONOS_HTTP_MAX_KEEPALIVE=100
DECISIONOS_HTTP_MAX_CONNS=200
DECISIONOS_HTTP_KEEPALIVE_SECS=30
DECISIONOS_CB_WINDOW=30
DECISIONOS_CB_FAIL_RATIO=0.5
DECISIONOS_CB_COOL_SECS=10

# ===== APM OTLP (u-12) =====
DECISIONOS_OTLP_ENABLE=0
OTLP_ENDPOINT=http://otel-collector:4318/v1/traces
